<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#7c3aed">
    <meta name="description" content="AI-powered insurance coverage analyzer - Find gaps, overlaps, and optimize your insurance portfolio">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>InsureAI - Smart Insurance Assistant</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translate(-50%, 100px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        
        .premium-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Install Prompt -->
    <div id="installPrompt" class="install-prompt">
        <div class="flex items-center gap-4">
            <div>
                <p class="font-bold mb-1">Install InsureAI App</p>
                <p class="text-sm opacity-90">Get quick access from your home screen</p>
            </div>
            <button onclick="installApp()" class="bg-white text-purple-600 px-4 py-2 rounded-lg font-bold hover:bg-gray-100">
                Install
            </button>
            <button onclick="dismissInstall()" class="text-white opacity-75 hover:opacity-100">
                âœ•
            </button>
        </div>
    </div>
    
    <script>
        // PWA Install Prompt
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
        });
        
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('App installed');
                    }
                    deferredPrompt = null;
                    document.getElementById('installPrompt').style.display = 'none';
                });
            }
        }
        
        function dismissInstall() {
            document.getElementById('installPrompt').style.display = 'none';
        }
        
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker error:', err));
            });
        }
        
        // Configure PDF.js
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
    </script>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Icon Components
        const Shield = () => <i className="fas fa-shield-alt"></i>;
        const Upload = () => <i className="fas fa-upload"></i>;
        const Brain = () => <i className="fas fa-brain"></i>;
        const FileText = () => <i className="fas fa-file-alt"></i>;
        const AlertTriangle = () => <i className="fas fa-exclamation-triangle"></i>;
        const CheckCircle = () => <i className="fas fa-check-circle"></i>;
        const TrendingUp = () => <i className="fas fa-chart-line"></i>;
        const Download = () => <i className="fas fa-download"></i>;
        const Save = () => <i className="fas fa-save"></i>;
        const Trash2 = () => <i className="fas fa-trash"></i>;
        const Plus = () => <i className="fas fa-plus"></i>;
        const Loader = () => <i className="fas fa-spinner fa-spin"></i>;
        const Bell = () => <i className="fas fa-bell"></i>;
        const Crown = () => <i className="fas fa-crown"></i>;
        const Lock = () => <i className="fas fa-lock"></i>;
        const Mail = () => <i className="fas fa-envelope"></i>;
        const Camera = () => <i className="fas fa-camera"></i>;
        const FilePdf = () => <i className="fas fa-file-pdf"></i>;

        const InsuranceAIAssistant = () => {
          const [userInfo, setUserInfo] = useState({
            firstName: '', lastName: '', dateOfBirth: '', nationality: '',
            occupation: '', dependents: 0, healthConditions: '', email: ''
          });
          
          const [policies, setPolicies] = useState([]);
          const [activeTab, setActiveTab] = useState('dashboard');
          const [language, setLanguage] = useState('en');
          const [aiAnalysis, setAiAnalysis] = useState(null);
          const [isAnalyzing, setIsAnalyzing] = useState(false);
          const [saveMessage, setSaveMessage] = useState('');
          const [showManualEntry, setShowManualEntry] = useState(false);
          const [isPremium, setIsPremium] = useState(false);
          const [analysisCount, setAnalysisCount] = useState(0);
          const [showPremiumModal, setShowPremiumModal] = useState(false);
          const [showEmailModal, setShowEmailModal] = useState(false);
          const [newPolicy, setNewPolicy] = useState({
            policyName: '', provider: '', premium: '', excess: '', benefits: '', exclusions: ''
          });

          // Load data from localStorage (persistent across sessions)
          useEffect(() => {
            try {
              const saved = localStorage.getItem('insuranceAIData');
              if (saved) {
                const data = JSON.parse(saved);
                if (data.userInfo) setUserInfo(data.userInfo);
                if (data.policies) setPolicies(data.policies);
                if (data.language) setLanguage(data.language);
                if (data.aiAnalysis) setAiAnalysis(data.aiAnalysis);
                if (data.isPremium) setIsPremium(data.isPremium);
                if (data.analysisCount) setAnalysisCount(data.analysisCount);
              }
            } catch (error) {
              console.log('No saved data');
            }
          }, []);

          // Save data to localStorage
          useEffect(() => {
            try {
              localStorage.setItem('insuranceAIData', JSON.stringify({
                userInfo, policies, language, aiAnalysis, isPremium, analysisCount
              }));
            } catch (error) {
              console.log('Error saving');
            }
          }, [userInfo, policies, language, aiAnalysis, isPremium, analysisCount]);

          const translations = {
            en: {
              appTitle: "InsureAI",
              tagline: "Smart Insurance Coverage Analysis",
              dashboard: "Dashboard", profile: "My Profile", policies: "My Policies", 
              analysis: "AI Analysis", settings: "Settings",
              firstName: "First Name", lastName: "Last Name", dateOfBirth: "Date of Birth",
              email: "Email Address",
              nationality: "Nationality", occupation: "Occupation", dependents: "Number of Dependents",
              healthConditions: "Health Conditions (optional)", saveProfile: "Save Profile",
              addPolicy: "Add Policy", uploadFile: "Upload File", scanDocument: "Scan Document",
              policyName: "Policy Name", provider: "Provider", premium: "Annual Premium (â‚¬)", 
              excess: "Excess (â‚¬)", benefits: "Benefits (comma separated)", 
              exclusions: "Exclusions (comma separated)",
              analyzeWithAI: "Analyze Coverage with AI", analyzing: "AI is analyzing your coverage...",
              noPolicies: "No policies added yet", addFirstPolicy: "Add your first policy to get started",
              welcomeBack: "Welcome back", totalPolicies: "Total Policies", 
              totalPremium: "Total Annual Premium", lastAnalysis: "Last Analysis", 
              runAnalysis: "Run New Analysis", gaps: "Coverage Gaps", overlaps: "Coverage Overlaps", 
              recommendations: "Recommendations", clearData: "Clear All Data", age: "Age", 
              manualEntry: "Manual Entry", cancel: "Cancel", save: "Save", delete: "Delete",
              upgradeToPremium: "Upgrade to Premium", downloadReport: "Download PDF Report",
              emailReport: "Email Report", freeAnalysisLimit: "Free Analysis Used",
              premiumFeatures: "Premium Features", unlimitedAnalysis: "Unlimited AI Analysis",
              pdfReports: "Professional PDF Reports", emailSupport: "Priority Email Support",
              renewalReminders: "Policy Renewal Reminders", costOptimization: "Cost Optimization Tools",
              getStarted: "Get Started - â‚¬9.99/month", viewPlans: "View Pricing Plans",
              analysesRemaining: "analyses remaining this month",
              needMoreAnalyses: "Need more analyses?",
              sendToEmail: "Send Report to Email", sending: "Sending...",
              reportSent: "Report sent successfully!", close: "Close",
              scanPolicyDocument: "Scan Policy Document",
              takePicture: "Take Picture", uploadPDF: "Upload PDF",
              processingDocument: "Processing document...",
              documentProcessed: "Document processed successfully!",
              freeTier: "Free Tier", premiumTier: "Premium"
            },
            gr: {
              appTitle: "InsureAI",
              tagline: "ÎˆÎ¾Ï…Ï€Î½Î· Î‘Î½Î¬Î»Ï…ÏƒÎ· Î‘ÏƒÏ†Î±Î»Î¹ÏƒÏ„Î¹ÎºÎ®Ï‚ ÎšÎ¬Î»Ï…ÏˆÎ·Ï‚",
              dashboard: "Î Î¯Î½Î±ÎºÎ±Ï‚", profile: "Î ÏÎ¿Ï†Î¯Î»", policies: "Î Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚", 
              analysis: "Î‘Î½Î¬Î»Ï…ÏƒÎ· AI", settings: "Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚",
              firstName: "ÎŒÎ½Î¿Î¼Î±", lastName: "Î•Ï€ÏŽÎ½Ï…Î¼Î¿", dateOfBirth: "Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î“Î­Î½Î½Î·ÏƒÎ·Ï‚",
              email: "Email",
              nationality: "Î•Î¸Î½Î¹ÎºÏŒÏ„Î·Ï„Î±", occupation: "Î•Ï€Î¬Î³Î³ÎµÎ»Î¼Î±", dependents: "Î•Î¾Î±ÏÏ„ÏŽÎ¼ÎµÎ½Î¿Î¹",
              healthConditions: "Î ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î± Î¥Î³ÎµÎ¯Î±Ï‚", saveProfile: "Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·",
              addPolicy: "Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ·", uploadFile: "ÎœÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ·", scanDocument: "Î£Î¬ÏÏ‰ÏƒÎ·",
              policyName: "ÎŒÎ½Î¿Î¼Î±", provider: "Î Î¬ÏÎ¿Ï‡Î¿Ï‚", premium: "Î‘ÏƒÏ†Î¬Î»Î¹ÏƒÏ„ÏÎ¿ (â‚¬)", 
              excess: "Î‘Ï€Î±Î»Î»Î±Î³Î® (â‚¬)", benefits: "Î Î±ÏÎ¿Ï‡Î­Ï‚", exclusions: "Î•Î¾Î±Î¹ÏÎ­ÏƒÎµÎ¹Ï‚",
              analyzeWithAI: "Î‘Î½Î¬Î»Ï…ÏƒÎ· Î¼Îµ AI", analyzing: "Î‘Î½Î¬Î»Ï…ÏƒÎ·...",
              noPolicies: "Î§Ï‰ÏÎ¯Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚", addFirstPolicy: "Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®",
              welcomeBack: "ÎšÎ±Î»ÏŽÏ‚ Î®ÏÎ¸Î±Ï„Îµ", totalPolicies: "Î Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚", 
              totalPremium: "Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ Î‘ÏƒÏ†Î¬Î»Î¹ÏƒÏ„ÏÎ¿", lastAnalysis: "Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î‘Î½Î¬Î»Ï…ÏƒÎ·", 
              runAnalysis: "ÎÎ­Î± Î‘Î½Î¬Î»Ï…ÏƒÎ·", gaps: "ÎšÎµÎ½Î¬", overlaps: "Î•Ï€Î¹ÎºÎ±Î»ÏÏˆÎµÎ¹Ï‚", 
              recommendations: "Î£Ï…ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚", clearData: "Î”Î¹Î±Î³ÏÎ±Ï†Î®", age: "Î—Î»Î¹ÎºÎ¯Î±", 
              manualEntry: "Î§ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î±", cancel: "Î‘ÎºÏÏÏ‰ÏƒÎ·", save: "Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·", 
              delete: "Î”Î¹Î±Î³ÏÎ±Ï†Î®", upgradeToPremium: "Î‘Î½Î±Î²Î¬Î¸Î¼Î¹ÏƒÎ·", 
              downloadReport: "Î›Î®ÏˆÎ· PDF", emailReport: "Email Î‘Î½Î±Ï†Î¿ÏÎ¬Ï‚",
              freeAnalysisLimit: "Î”Ï‰ÏÎµÎ¬Î½ Î‘Î½Î¬Î»Ï…ÏƒÎ· Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ",
              getStarted: "ÎžÎµÎºÎ¹Î½Î®ÏƒÏ„Îµ - â‚¬9.99/Î¼Î®Î½Î±", analysesRemaining: "Î±Î½Î±Î»ÏÏƒÎµÎ¹Ï‚ Î±Ï€Î¿Î¼Î­Î½Î¿Ï…Î½",
              sendToEmail: "Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® ÏƒÎµ Email", close: "ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿"
            }
          };

          const t = translations[language];

          const calculateAge = (dob) => {
            if (!dob) return null;
            const today = new Date();
            const birthDate = new Date(dob);
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
              age--;
            }
            return age;
          };

          // PDF Reading Function
 
        const handlePDFUpload = async (event) => {
          const file = event.target.files[0];
          if (!file) return;
        
          try {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let fullText = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
              const page = await pdf.getPage(i);
              const textContent = await page.getTextContent();
              const pageText = textContent.items.map(item => item.str).join(' ');
              fullText += pageText + '\n';
            }
            
            // Extract policy info using AI
            setSaveMessage(t.processingDocument || 'Processing document...');
            
            // âœ… USE SERVERLESS FUNCTION INSTEAD OF DIRECT API CALL
            const response = await fetch("/.netlify/functions/analyze", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                prompt: `Extract insurance policy information from this text and return ONLY a JSON object:
        
        ${fullText}
        
        Return this exact structure:
        {
          "policyName": "<policy name>",
          "provider": "<insurance company>",
          "premium": <annual premium number>,
          "excess": <excess/deductible number>,
          "benefits": "<comma separated benefits>",
          "exclusions": "<comma separated exclusions>"
        }
        
        If information is missing, use empty string or 0. ONLY return valid JSON, nothing else.`
              })
            });
        
            if (!response.ok) {
              throw new Error('Failed to process PDF');
            }
        
            const data = await response.json();
            let responseText = data.content[0].text;
            responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
            
            const extractedPolicy = JSON.parse(responseText);
            setPolicies([...policies, extractedPolicy]);
            
            setSaveMessage(t.documentProcessed || 'Document processed successfully!');
            setTimeout(() => setSaveMessage(''), 3000);
          } catch (error) {
            console.error('PDF processing error:', error);
            alert('Error processing PDF. Please try manual entry.');
          }
        };

          const analyzeWithAI = async () => {
            // Check free tier limit
            if (!isPremium && analysisCount >= 1) {
              setShowPremiumModal(true);
              return;
            }

            if (policies.length === 0) {
              alert(language === 'en' ? 'Please add at least one policy first' : 'Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Ï€ÏÏŽÏ„Î±');
              return;
            }

            setIsAnalyzing(true);
            setActiveTab('analysis');

            const age = calculateAge(userInfo.dateOfBirth);
            const profileContext = `
User Profile:
- Name: ${userInfo.firstName} ${userInfo.lastName}
- Age: ${age || 'Not provided'}
- Occupation: ${userInfo.occupation || 'Not provided'}
- Dependents: ${userInfo.dependents}
- Health Conditions: ${userInfo.healthConditions || 'None'}
- Nationality: ${userInfo.nationality || 'Not provided'}

Current Insurance Policies:
${policies.map((p, i) => `
Policy ${i + 1}: ${p.policyName}
- Provider: ${p.provider}
- Annual Premium: â‚¬${p.premium}
- Excess: â‚¬${p.excess}
- Benefits: ${p.benefits}
- Exclusions: ${p.exclusions}
`).join('\n')}`;

            const prompt = `You are an expert insurance analyst. Analyze this portfolio and provide comprehensive assessment in JSON format.

${profileContext}

Respond as valid JSON (all text in ${language === 'en' ? 'English' : 'Greek'}):

{
  "overallScore": <0-100>,
  "summary": "<2-3 sentence overview>",
  "coverageGaps": [
    {
      "severity": "<critical|high|medium|low>",
      "category": "<gap category>",
      "description": "<detailed description>",
      "impact": "<why this matters>",
      "recommendation": "<what to do>"
    }
  ],
  "coverageOverlaps": [
    {
      "type": "<overlap type>",
      "policies": ["<policy names>"],
      "description": "<what's overlapping>",
      "wastedCost": <euros>,
      "recommendation": "<suggestion>"
    }
  ],
  "recommendations": [
    {
      "priority": "<high|medium|low>",
      "action": "<action title>",
      "description": "<detailed explanation>",
      "estimatedCost": "<cost range>",
      "timeline": "<when to do this>"
    }
  ],
  "strengths": ["<good things>"],
  "potentialSavings": <total euros that could be saved>,
  "riskLevel": "<low|medium|high>",
  "nextReviewDate": "<suggested date>"
}

IMPORTANT: Valid JSON only. Consider age, occupation, dependents. Look for life insurance, disability, critical illness gaps.`;

            try {
             // Call our serverless function instead of Anthropic directly
            const response = await fetch("/.netlify/functions/analyze", {
              method: "POST",
              headers: { 
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                prompt: prompt
              })
            });
            
            if (!response.ok) {
              const errorData = await response.json();
              console.error('Serverless function error:', errorData);
              throw new Error(errorData.error || `API failed: ${response.status}`);
            }
            
            const data = await response.json();
            
            // Check if response has the expected structure
            if (!data.content || !data.content[0] || !data.content[0].text) {
              console.error('Unexpected response structure:', data);
              throw new Error('Invalid response from AI service');
            }
            
            let responseText = data.content[0].text; 
              responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
              
              const analysis = JSON.parse(responseText);
              setAiAnalysis(analysis);
              
             
              if (!isPremium) {
                setAnalysisCount(analysisCount + 1);
              }
              
              setSaveMessage(language === 'en' ? 'Analysis complete!' : 'ÎŸÎ»Î¿ÎºÎ»Î·ÏÏŽÎ¸Î·ÎºÎµ!');
              setTimeout(() => setSaveMessage(''), 3000);
            } catch (error) {
              console.error('AI Error:', error);
              alert(language === 'en' ? 'Error analyzing. Try again.' : 'Î£Ï†Î¬Î»Î¼Î± Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚.');
            } finally {
              setIsAnalyzing(false);
            }
          };

          const sendEmailReport = async () => {
            if (!userInfo.email) {
              alert(language === 'en' ? 'Please add your email in profile' : 'Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ email ÏƒÏ„Î¿ Ï€ÏÎ¿Ï†Î¯Î»');
              return;
            }

            if (!isPremium) {
              setShowPremiumModal(true);
              return;
            }

            setSaveMessage(t.sending || 'Sending...');
            
            // Simulate email sending (you'd integrate with EmailJS, SendGrid, etc.)
            setTimeout(() => {
              setSaveMessage(t.reportSent || 'Report sent!');
              setTimeout(() => setSaveMessage(''), 3000);
              setShowEmailModal(false);
            }, 2000);
          };

          const handleFileUpload = async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            // Check if it's a PDF
            if (file.name.endsWith('.pdf')) {
              await handlePDFUpload(event);
              return;
            }

            try {
              const text = await file.text();
              let parsedPolicies;

              if (file.name.endsWith('.json')) {
                parsedPolicies = JSON.parse(text);
              } else if (file.name.endsWith('.csv')) {
                const lines = text.split('\n');
                const headers = lines[0].split(',').map(h => h.trim());
                parsedPolicies = lines.slice(1).filter(line => line.trim()).map(line => {
                  const values = line.split(',').map(v => v.trim());
                  const policy = {};
                  headers.forEach((header, idx) => {
                    policy[header] = values[idx];
                  });
                  return policy;
                });
              }

              setPolicies(prev => [...prev, ...(Array.isArray(parsedPolicies) ? parsedPolicies : [parsedPolicies])]);
              setSaveMessage(language === 'en' ? 'Policies uploaded!' : 'ÎœÎµÏ„Î±Ï†Î¿ÏÏ„ÏŽÎ¸Î·ÎºÎ±Î½!');
              setTimeout(() => setSaveMessage(''), 2000);
            } catch (error) {
              alert(language === 'en' ? 'Error reading file' : 'Î£Ï†Î¬Î»Î¼Î± Î±ÏÏ‡ÎµÎ¯Î¿Ï…');
            }
          };

          const addManualPolicy = () => {
            if (!newPolicy.policyName || !newPolicy.provider) {
              alert(language === 'en' ? 'Fill required fields' : 'Î£Ï…Î¼Ï€Î»Î·ÏÏŽÏƒÏ„Îµ Ï€ÎµÎ´Î¯Î±');
              return;
            }
            setPolicies([...policies, {
              ...newPolicy,
              premium: parseFloat(newPolicy.premium) || 0,
              excess: parseFloat(newPolicy.excess) || 0
            }]);
            setNewPolicy({ policyName: '', provider: '', premium: '', excess: '', benefits: '', exclusions: '' });
            setShowManualEntry(false);
          };

          const deletePolicy = (index) => {
            if (confirm(language === 'en' ? 'Delete?' : 'Î”Î¹Î±Î³ÏÎ±Ï†Î®;')) {
              setPolicies(policies.filter((_, i) => i !== index));
            }
          };

          const downloadPDFReport = () => {
            if (!isPremium) {
              setShowPremiumModal(true);
              return;
            }

            // PDF generation code from previous version
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text("Insurance Analysis Report", 20, 20);
            doc.text(`Score: ${aiAnalysis?.overallScore || 'N/A'}`, 20, 30);
            doc.save(`insurance-analysis-${new Date().toISOString().split('T')[0]}.pdf`);
          };

          const getSeverityColor = (severity) => {
            const colors = {
              critical: 'bg-red-100 border-red-500 text-red-900',
              high: 'bg-orange-100 border-orange-500 text-orange-900',
              medium: 'bg-yellow-100 border-yellow-500 text-yellow-900',
              low: 'bg-blue-100 border-blue-500 text-blue-900'
            };
            return colors[severity] || colors.medium;
          };

          const getPriorityBadge = (priority) => {
            const badges = {
              high: 'bg-red-500 text-white',
              medium: 'bg-yellow-500 text-white',
              low: 'bg-green-500 text-white'
            };
            return badges[priority] || badges.medium;
          };

          // Premium Modal
          const PremiumModal = () => (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl p-8 max-w-2xl w-full">
                <div className="text-center mb-6">
                  <Crown className="text-yellow-500 text-4xl mb-4" />
                  <h2 className="text-3xl font-bold text-gray-800 mb-2">{t.upgradeToPremium}</h2>
                  <p className="text-gray-600">Unlock unlimited analyses and premium features</p>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                  <div className="border-2 border-gray-200 rounded-xl p-6">
                    <h3 className="text-xl font-bold mb-4">{t.freeTier}</h3>
                    <p className="text-3xl font-bold mb-4">â‚¬0<span className="text-sm text-gray-500">/month</span></p>
                    <ul className="space-y-2 text-sm">
                      <li className="flex items-center gap-2"><CheckCircle className="text-green-500" /> 1 AI analysis/month</li>
                      <li className="flex items-center gap-2"><CheckCircle className="text-green-500" /> Basic features</li>
                      <li className="flex items-center gap-2 text-gray-400"><Lock /> PDF reports</li>
                      <li className="flex items-center gap-2 text-gray-400"><Lock /> Email delivery</li>
                      <li className="flex items-center gap-2 text-gray-400"><Lock /> Priority support</li>
                    </ul>
                  </div>

                  <div className="border-2 border-purple-500 rounded-xl p-6 bg-gradient-to-br from-purple-50 to-blue-50 relative">
                    <div className="absolute -top-3 -right-3 premium-badge">POPULAR</div>
                    <h3 className="text-xl font-bold mb-4">{t.premiumTier}</h3>
                    <p className="text-3xl font-bold mb-4">â‚¬9.99<span className="text-sm text-gray-500">/month</span></p>
                    <ul className="space-y-2 text-sm mb-6">
                      <li className="flex items-center gap-2"><CheckCircle className="text-green-500" /> Unlimited AI analyses</li>
                      <li className="flex items-center gap-2"><CheckCircle className="text-green-500" /> PDF report downloads</li>
                      <li className="flex items-center gap-2"><CheckCircle className="text-green-500" /> Email report delivery</li>
                      <li className="flex items-center gap-2"><CheckCircle className="text-green-500" /> Renewal reminders</li>
                      <li className="flex items-center gap-2"><CheckCircle className="text-green-500" /> Priority support</li>
                      <li className="flex items-center gap-2"><CheckCircle className="text-green-500" /> Cost optimizer</li>
                    </ul>
                    <button
                      onClick={() => {
                        setIsPremium(true);
                        setShowPremiumModal(false);
                        alert('Premium activated! (Demo mode - integrate Stripe for real payments)');
                      }}
                      className="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-bold hover:opacity-90 transition"
                    >
                      {t.getStarted}
                    </button>
                  </div>
                </div>

                <button
                  onClick={() => setShowPremiumModal(false)}
                  className="w-full bg-gray-200 text-gray-800 py-2 rounded-lg font-semibold hover:bg-gray-300"
                >
                  {t.close}
                </button>
              </div>
            </div>
          );

          const renderDashboard = () => {
            const totalPremium = policies.reduce((sum, p) => sum + (parseFloat(p.premium) || 0), 0);
            const age = calculateAge(userInfo.dateOfBirth);

            return (
              <div className="space-y-6">
                {/* Premium Status Banner */}
                {!isPremium && (
                  <div className="bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg p-4">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <Crown />
                        <div>
                          <p className="font-bold">{analysisCount}/1 {t.analysesRemaining}</p>
                          <p className="text-sm opacity-90">{t.needMoreAnalyses}</p>
                        </div>
                      </div>
                      <button
                        onClick={() => setShowPremiumModal(true)}
                        className="bg-white text-purple-600 px-4 py-2 rounded-lg font-bold hover:bg-gray-100"
                      >
                        {t.upgradeToPremium}
                      </button>
                    </div>
                  </div>
                )}

                <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-6">
                  <h2 className="text-2xl font-bold mb-2">
                    {t.welcomeBack}, {userInfo.firstName || 'User'}! 
                    {isPremium && <Crown className="inline ml-2 text-yellow-300" />}
                  </h2>
                  {age && <p className="text-blue-100">{t.age}: {age}</p>}
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div className="bg-white rounded-lg p-6 border-2 border-gray-200">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="text-gray-600 text-sm">{t.totalPolicies}</h3>
                      <Shield />
                    </div>
                    <p className="text-3xl font-bold text-gray-800">{policies.length}</p>
                  </div>

                  <div className="bg-white rounded-lg p-6 border-2 border-gray-200">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="text-gray-600 text-sm">{t.totalPremium}</h3>
                      <TrendingUp />
                    </div>
                    <p className="text-3xl font-bold text-gray-800">â‚¬{totalPremium.toLocaleString()}</p>
                    <p className="text-xs text-gray-500 mt-1">â‚¬{(totalPremium/12).toFixed(0)}/month</p>
                  </div>

                  <div className="bg-white rounded-lg p-6 border-2 border-gray-200">
                    <div className="flex items-center justify-between mb-2">
                      <h3 className="text-gray-600 text-sm">{t.lastAnalysis}</h3>
                      <Brain />
                    </div>
                    <p className="text-xl font-bold text-gray-800">
                      {aiAnalysis ? 'Recent' : 'Not yet'}
                    </p>
                  </div>
                </div>

                {aiAnalysis && (
                  <div className="bg-white rounded-lg p-6 border-2 border-purple-200">
                    <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                      <Brain /> AI Coverage Score
                    </h3>
                    <div className="flex items-center gap-4">
                      <div className="relative w-24 h-24">
                        <svg className="transform -rotate-90 w-24 h-24">
                          <circle cx="48" cy="48" r="40" stroke="#e5e7eb" strokeWidth="8" fill="none" />
                          <circle 
                            cx="48" cy="48" r="40" 
                            stroke={aiAnalysis.overallScore >= 70 ? '#10b981' : aiAnalysis.overallScore >= 50 ? '#f59e0b' : '#ef4444'}
                            strokeWidth="8" 
                            fill="none"
                            strokeDasharray={`${2 * Math.PI * 40 * aiAnalysis.overallScore / 100} ${2 * Math.PI * 40}`}
                          />
                        </svg>
                        <div className="absolute inset-0 flex items-center justify-center">
                          <span className="text-2xl font-bold">{aiAnalysis.overallScore}</span>
                        </div>
                      </div>
                      <div className="flex-1">
                        <p className="text-gray-700">{aiAnalysis.summary}</p>
                        {aiAnalysis.potentialSavings > 0 && (
                          <p className="text-green-600 font-bold mt-2">
                            ðŸ’° Potential savings: â‚¬{aiAnalysis.potentialSavings}/year
                          </p>
                        )}
                      </div>
                    </div>
                  </div>
                )}

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <button
                    onClick={() => setActiveTab('policies')}
                    className="bg-blue-600 text-white py-4 rounded-lg font-semibold hover:bg-blue-700 transition flex items-center justify-center gap-2"
                  >
                    <Shield /> {t.policies}
                  </button>
                  <button
                    onClick={analyzeWithAI}
                    disabled={policies.length === 0 || isAnalyzing}
                    className="bg-purple-600 text-white py-4 rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-300 transition flex items-center justify-center gap-2"
                  >
                    {isAnalyzing ? <Loader /> : <Brain />} 
                    {isAnalyzing ? t.analyzing : t.runAnalysis}
                  </button>
                </div>
              </div>
            );
          };

          const renderProfile = () => (
            <div className="space-y-6">
              <h2 className="text-2xl font-bold text-gray-800">{t.profile}</h2>
              
              <div className="bg-white rounded-lg p-6 border-2 border-gray-200 space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{t.firstName}</label>
                    <input
                      type="text"
                      value={userInfo.firstName}
                      onChange={(e) => setUserInfo({...userInfo, firstName: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{t.lastName}</label>
                    <input
                      type="text"
                      value={userInfo.lastName}
                      onChange={(e) => setUserInfo({...userInfo, lastName: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">{t.email}</label>
                  <input
                    type="email"
                    value={userInfo.email}
                    onChange={(e) => setUserInfo({...userInfo, email: e.target.value})}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    placeholder="your@email.com"
                  />
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{t.dateOfBirth}</label>
                    <input
                      type="date"
                      value={userInfo.dateOfBirth}
                      onChange={(e) => setUserInfo({...userInfo, dateOfBirth: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{t.nationality}</label>
                    <input
                      type="text"
                      value={userInfo.nationality}
                      onChange={(e) => setUserInfo({...userInfo, nationality: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{t.occupation}</label>
                    <input
                      type="text"
                      value={userInfo.occupation}
                      onChange={(e) => setUserInfo({...userInfo, occupation: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{t.dependents}</label>
                    <input
                      type="number"
                      value={userInfo.dependents}
                      onChange={(e) => setUserInfo({...userInfo, dependents: parseInt(e.target.value) || 0})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">{t.healthConditions}</label>
                  <textarea
                    value={userInfo.healthConditions}
                    onChange={(e) => setUserInfo({...userInfo, healthConditions: e.target.value})}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    rows="3"
                  />
                </div>

                <button
                  onClick={() => {
                    setSaveMessage(language === 'en' ? 'Profile saved!' : 'Î‘Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ!');
                    setTimeout(() => setSaveMessage(''), 2000);
                  }}
                  className="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700"
                >
                  {t.saveProfile}
                </button>
              </div>
            </div>
          );

          const renderPolicies = () => (
            <div className="space-y-6">
              <div className="flex justify-between items-center flex-wrap gap-2">
                <h2 className="text-2xl font-bold text-gray-800">{t.policies}</h2>
                <div className="flex gap-2 flex-wrap">
                  <label className="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 cursor-pointer transition flex items-center gap-2">
                    <Upload /> {t.uploadFile}
                    <input type="file" accept=".csv,.json,.pdf" onChange={handleFileUpload} className="hidden" />
                  </label>
                  <button
                    onClick={() => setShowManualEntry(true)}
                    className="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700 transition flex items-center gap-2"
                  >
                    <Plus /> {t.manualEntry}
                  </button>
                </div>
              </div>

              {showManualEntry && (
                <div className="bg-white rounded-lg p-6 border-2 border-green-200">
                  <h3 className="font-bold text-gray-800 mb-4">{t.addPolicy}</h3>
                  <div className="space-y-3">
                    <input
                      type="text"
                      placeholder={t.policyName}
                      value={newPolicy.policyName}
                      onChange={(e) => setNewPolicy({...newPolicy, policyName: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                    <input
                      type="text"
                      placeholder={t.provider}
                      value={newPolicy.provider}
                      onChange={(e) => setNewPolicy({...newPolicy, provider: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                    />
                    <div className="grid grid-cols-2 gap-3">
                      <input
                        type="number"
                        placeholder={t.premium}
                        value={newPolicy.premium}
                        onChange={(e) => setNewPolicy({...newPolicy, premium: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                      />
                      <input
                        type="number"
                        placeholder={t.excess}
                        value={newPolicy.excess}
                        onChange={(e) => setNewPolicy({...newPolicy, excess: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                      />
                    </div>
                    <textarea
                      placeholder={t.benefits}
                      value={newPolicy.benefits}
                      onChange={(e) => setNewPolicy({...newPolicy, benefits: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                      rows="2"
                    />
                    <textarea
                      placeholder={t.exclusions}
                      value={newPolicy.exclusions}
                      onChange={(e) => setNewPolicy({...newPolicy, exclusions: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                      rows="2"
                    />
                    <div className="flex gap-2">
                      <button onClick={addManualPolicy} className="flex-1 bg-green-600 text-white py-2 rounded-lg font-semibold">
                        {t.save}
                      </button>
                      <button onClick={() => setShowManualEntry(false)} className="flex-1 bg-gray-300 text-gray-800 py-2 rounded-lg font-semibold">
                        {t.cancel}
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {policies.length === 0 ? (
                <div className="bg-gray-50 rounded-lg p-12 text-center">
                  <Shield className="text-gray-400 text-5xl mb-4" />
                  <p className="text-gray-600 text-lg">{t.noPolicies}</p>
                  <p className="text-gray-500 text-sm mt-2">{t.addFirstPolicy}</p>
                </div>
              ) : (
                <div className="space-y-4">
                  {policies.map((policy, idx) => (
                    <div key={idx} className="bg-white rounded-lg p-6 border-2 border-gray-200 hover:border-purple-300 transition">
                      <div className="flex justify-between items-start mb-3">
                        <div>
                          <h3 className="text-xl font-bold text-gray-800">{policy.policyName}</h3>
                          <p className="text-gray-600">{policy.provider}</p>
                        </div>
                        <button onClick={() => deletePolicy(idx)} className="text-red-600 hover:text-red-700">
                          <Trash2 />
                        </button>
                      </div>
                      <div className="grid grid-cols-2 gap-4 text-sm">
                        <div>
                          <span className="font-medium text-gray-700">{t.premium}:</span>
                          <span className="ml-2 text-gray-900">â‚¬{policy.premium}</span>
                        </div>
                        <div>
                          <span className="font-medium text-gray-700">{t.excess}:</span>
                          <span className="ml-2 text-gray-900">â‚¬{policy.excess}</span>
                        </div>
                      </div>
                      {policy.benefits && (
                        <div className="mt-3 text-sm">
                          <span className="font-medium text-gray-700">Benefits:</span>
                          <p className="text-gray-600 mt-1">{policy.benefits}</p>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              )}
            </div>
          );

          const renderAnalysis = () => {
            if (isAnalyzing) {
              return (
                <div className="flex flex-col items-center justify-center py-20">
                  <Loader className="text-purple-600 text-5xl mb-4" />
                  <p className="text-gray-600 text-lg">{t.analyzing}</p>
                  <p className="text-gray-500 text-sm mt-2">This may take 10-15 seconds...</p>
                </div>
              );
            }

            if (!aiAnalysis) {
              return (
                <div className="text-center py-20">
                  <Brain className="text-gray-400 text-5xl mb-4" />
                  <p className="text-gray-600 text-lg mb-4">No AI analysis yet</p>
                  <button
                    onClick={analyzeWithAI}
                    disabled={policies.length === 0}
                    className="bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-300"
                  >
                    {t.analyzeWithAI}
                  </button>
                </div>
              );
            }

            return (
              <div className="space-y-6">
                <div className="bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg p-6">
                  <div className="flex justify-between items-start">
                    <div>
                      <h2 className="text-2xl font-bold mb-2">{t.analysis}</h2>
                      <p className="text-purple-100">AI-powered comprehensive coverage analysis</p>
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={downloadPDFReport}
                        className="bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold hover:bg-gray-100 flex items-center gap-2"
                      >
                        <Download /> PDF
                      </button>
                      <button
                        onClick={() => setShowEmailModal(true)}
                        className="bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold hover:bg-gray-100 flex items-center gap-2"
                      >
                        <Mail /> Email
                      </button>
                    </div>
                  </div>
                </div>

                {/* Rest of analysis rendering - gaps, overlaps, recommendations, strengths */}
                {/* Copy from previous version */}

                <div>
                  <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <AlertTriangle /> {t.gaps}
                  </h3>
                  {aiAnalysis.coverageGaps && aiAnalysis.coverageGaps.length > 0 ? (
                    <div className="space-y-4">
                      {aiAnalysis.coverageGaps.map((gap, idx) => (
                        <div key={idx} className={`rounded-lg p-6 border-2 ${getSeverityColor(gap.severity)}`}>
                          <div className="flex items-start justify-between mb-3">
                            <div>
                              <span className="text-xs font-bold uppercase">{gap.severity}</span>
                              <h4 className="text-lg font-bold mt-1">{gap.category}</h4>
                            </div>
                            <AlertTriangle />
                          </div>
                          <p className="mb-2">{gap.description}</p>
                          <div className="bg-white bg-opacity-50 rounded p-3 mt-3">
                            <p className="text-sm font-medium mb-1">Impact:</p>
                            <p className="text-sm">{gap.impact}</p>
                          </div>
                          <div className="bg-white bg-opacity-50 rounded p-3 mt-2">
                            <p className="text-sm font-medium mb-1">Recommendation:</p>
                            <p className="text-sm">{gap.recommendation}</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <p className="text-gray-600">No significant gaps detected</p>
                  )}
                </div>

                {aiAnalysis.coverageOverlaps && aiAnalysis.coverageOverlaps.length > 0 && (
                  <div>
                    <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                      <FileText /> {t.overlaps}
                    </h3>
                    <div className="space-y-4">
                      {aiAnalysis.coverageOverlaps.map((overlap, idx) => (
                        <div key={idx} className="bg-orange-50 border-2 border-orange-300 rounded-lg p-6">
                          <h4 className="text-lg font-bold text-orange-900 mb-2">{overlap.type}</h4>
                          <p className="text-orange-800 mb-2">{overlap.description}</p>
                          {overlap.wastedCost > 0 && (
                            <div className="bg-orange-100 rounded p-3 mb-2">
                              <p className="text-sm font-medium">ðŸ’° Wasted: â‚¬{overlap.wastedCost}/year</p>
                            </div>
                          )}
                          <div className="bg-white rounded p-3">
                            <p className="text-sm">{overlap.recommendation}</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                <div>
                  <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <CheckCircle /> {t.recommendations}
                  </h3>
                  <div className="space-y-4">
                    {aiAnalysis.recommendations.map((rec, idx) => (
                      <div key={idx} className="bg-white rounded-lg p-6 border-2 border-gray-200">
                        <div className="flex items-start justify-between mb-3">
                          <h4 className="text-lg font-bold">{rec.action}</h4>
                          <span className={`px-3 py-1 rounded-full text-xs font-bold ${getPriorityBadge(rec.priority)}`}>
                            {rec.priority.toUpperCase()}
                          </span>
                        </div>
                        <p className="text-gray-700 mb-3">{rec.description}</p>
                        <div className="grid grid-cols-2 gap-4 text-sm">
                          <div>
                            <span className="font-medium">Cost:</span>
                            <p>{rec.estimatedCost}</p>
                          </div>
                          <div>
                            <span className="font-medium">Timeline:</span>
                            <p>{rec.timeline}</p>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                {aiAnalysis.strengths && aiAnalysis.strengths.length > 0 && (
                  <div className="bg-green-50 border-2 border-green-300 rounded-lg p-6">
                    <h3 className="text-xl font-bold text-green-900 mb-4 flex items-center gap-2">
                      <CheckCircle /> Your Strengths
                    </h3>
                    <ul className="space-y-2">
                      {aiAnalysis.strengths.map((strength, idx) => (
                        <li key={idx} className="flex items-start gap-2 text-green-800">
                          <CheckCircle />
                          <span>{strength}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
              </div>
            );
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-50 p-4">
              <div className="max-w-6xl mx-auto">
                {/* Header */}
                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                  <div className="flex justify-between items-center flex-wrap gap-4">
                    <div className="flex items-center gap-3">
                      <div className="bg-gradient-to-br from-purple-600 to-blue-600 p-3 rounded-xl">
                        <Brain className="text-white text-2xl" />
                      </div>
                      <div>
                        <h1 className="text-2xl font-bold text-gray-800">
                          {t.appTitle}
                          {isPremium && <Crown className="inline ml-2 text-yellow-500" />}
                        </h1>
                        <p className="text-sm text-gray-600">{t.tagline}</p>
                        {saveMessage && (
                          <div className="flex items-center gap-2 text-green-600 text-sm mt-1">
                            <Save />
                            <span>{saveMessage}</span>
                          </div>
                        )}
                      </div>
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={() => setLanguage('en')}
                        className={`px-4 py-2 rounded-lg font-semibold ${
                          language === 'en' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700'
                        }`}
                      >
                        EN
                      </button>
                      <button
                        onClick={() => setLanguage('gr')}
                        className={`px-4 py-2 rounded-lg font-semibold ${
                          language === 'gr' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700'
                        }`}
                      >
                        Î•Î›
                      </button>
                      <button
                        onClick={() => {
                          if (confirm(language === 'en' ? 'Clear all?' : 'Î”Î¹Î±Î³ÏÎ±Ï†Î®;')) {
                            localStorage.removeItem('insuranceAIData');
                            window.location.reload();
                          }
                        }}
                        className="px-3 py-2 rounded-lg bg-red-100 text-red-600 hover:bg-red-200"
                      >
                        <Trash2 />
                      </button>
                    </div>
                  </div>
                </div>

                {/* Navigation */}
                <div className="bg-white rounded-lg shadow-lg p-2 mb-6 flex gap-2 overflow-x-auto">
                  {[
                    { id: 'dashboard', label: t.dashboard },
                    { id: 'profile', label: t.profile },
                    { id: 'policies', label: t.policies },
                    { id: 'analysis', label: t.analysis }
                  ].map(tab => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`px-4 py-2 rounded-lg font-semibold whitespace-nowrap transition ${
                        activeTab === tab.id
                          ? 'bg-gradient-to-r from-purple-600 to-blue-600 text-white'
                          : 'text-gray-700 hover:bg-gray-100'
                      }`}
                    >
                      {tab.label}
                    </button>
                  ))}
                </div>

                {/* Content */}
                <div className="bg-white rounded-lg shadow-lg p-6 min-h-96">
                  {activeTab === 'dashboard' && renderDashboard()}
                  {activeTab === 'profile' && renderProfile()}
                  {activeTab === 'policies' && renderPolicies()}
                  {activeTab === 'analysis' && renderAnalysis()}
                </div>

                <footer className="text-center mt-6 text-gray-600 text-sm">
                  <p>Â© 2025 InsureAI | Powered by Claude AI | <a href="#" className="text-purple-600 hover:underline">Terms</a> | <a href="#" className="text-purple-600 hover:underline">Privacy</a></p>
                </footer>
              </div>

              {/* Modals */}
              {showPremiumModal && <PremiumModal />}
              
              {showEmailModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-2xl p-8 max-w-md w-full">
                    <h3 className="text-2xl font-bold mb-4">{t.sendToEmail}</h3>
                    <p className="text-gray-600 mb-4">Report will be sent to: <strong>{userInfo.email}</strong></p>
                    <div className="flex gap-2">
                      <button
                        onClick={sendEmailReport}
                        className="flex-1 bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700"
                      >
                        <Mail className="inline mr-2" /> {t.sendToEmail}
                      </button>
                      <button
                        onClick={() => setShowEmailModal(false)}
                        className="flex-1 bg-gray-200 text-gray-800 py-3 rounded-lg font-semibold hover:bg-gray-300"
                      >
                        {t.cancel}
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };
        
        ReactDOM.render(<InsuranceAIAssistant />, document.getElementById('root'));
    </script>
</body>

</html>


